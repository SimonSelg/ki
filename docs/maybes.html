<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>ki.maybes API documentation</title>
<meta name="description" content="Monadic factory functions for safely handling errors in type construction." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<style>.homelink{display:block;font-size:2em;font-weight:bold;color:#555;padding-bottom:.5em;border-bottom:1px solid silver}.homelink:hover{color:inherit}.homelink img{max-width:20%;max-height:5em;margin:auto;margin-bottom:.3em}</style>
<link rel="canonical" href="ki/maybes.html">
<link rel="icon" href="u1F367-shavedice.svg">
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>ki.maybes</code></h1>
</header>
<section id="section-intro">
<p>Monadic factory functions for safely handling errors in type construction.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/env python3
&#34;&#34;&#34;Monadic factory functions for safely handling errors in type construction.&#34;&#34;&#34;

# pylint: disable=invalid-name, missing-class-docstring, broad-except
# pylint: disable=too-many-return-statements, too-many-lines

import configparser
from pathlib import Path

import git
from result import Result, Err, Ok, OkErr

from beartype import beartype

import ki.maybes as M
import ki.functional as F
from ki.monadic import monadic
from ki.types import (
    MODELS_FILE,
    ExtantFile,
    ExtantDir,
    EmptyDir,
    NoPath,
    KiRepo,
    KiRepoRef,
    RepoRef,
    MissingFileError,
    MissingDirectoryError,
    ExpectedFileButGotDirectoryError,
    ExpectedDirectoryButGotFileError,
    ExpectedEmptyDirectoryButGotNonEmptyDirectoryError,
    StrangeExtantPathError,
    NotKiRepoError,
    GitRefNotFoundError,
)

FS_ROOT = Path(&#34;/&#34;)

KI = &#34;.ki&#34;
GIT = &#34;.git&#34;
GITIGNORE_FILE = &#34;.gitignore&#34;
GITMODULES_FILE = &#34;.gitmodules&#34;

CONFIG_FILE = &#34;config&#34;
HASHES_FILE = &#34;hashes&#34;
BACKUPS_DIR = &#34;backups&#34;
LAST_PUSH_FILE = &#34;last_push&#34;
NO_SM_DIR = &#34;no_submodules_tree&#34;

REMOTE_CONFIG_SECTION = &#34;remote&#34;
COLLECTION_FILE_PATH_CONFIG_FIELD = &#34;path&#34;


BACKUPS_DIR_INFO = &#34;&#34;&#34;
This is the &#39;.ki/backups&#39; directory, used to store backups of the &#39;.anki2&#39;
collection database file before ki overwrites it during a push. It may be
missing because the current ki repository has become corrupted.
&#34;&#34;&#34;

CONFIG_FILE_INFO = &#34;&#34;&#34;
This is the &#39;.ki/config&#39; file, used to store the path to a &#39;.anki2&#39; collection
database file. It may be missing because the current ki repository has become
corrupted.
&#34;&#34;&#34;

HASHES_FILE_INFO = &#34;&#34;&#34;
This is the &#39;.ki/hashes&#39; file, used to store recent md5sums of the &#39;.anki2&#39;
collection database file, which allow ki to determine when updates should be
rejected, i.e. when the user must pull remote changes before they can push
local ones. It may be missing because the current ki repository has become
corrupted.
&#34;&#34;&#34;

MODELS_FILE_INFO = &#34;&#34;&#34;
This is the top-level &#39;models.json&#39; file, which contains serialized notetypes
for all notes in the current repository. Ki should always create this during
cloning. If it has been manually deleted, try reverting to an earlier commit.
Otherwise, it may indicate that the repository has become corrupted.
&#34;&#34;&#34;

LAST_PUSH_FILE_INFO = &#34;&#34;&#34;
This is the &#39;.ki/last_push&#39; file, used internally by ki to keep diffs and
eliminate unnecessary merge conflicts during pull operations. It should never
be missing, and if it is, the repository may have become corrupted.
&#34;&#34;&#34;

NO_MODULES_DIR_INFO = &#34;&#34;&#34;
This is the &#39;.ki/no_submodules_tree&#39; file, used internally by ki to keep track
of what notes need to be written/modified/deleted in the Anki database. It
should never be missing, and if it is, the repository may have become
corrupted.
&#34;&#34;&#34;

COL_FILE_INFO = &#34;&#34;&#34;
This is the &#39;.anki2&#39; database file that contains all the data for a user&#39;s
collection. This path was contained in the &#39;.ki/config&#39; file, indicating that
the collection this repository previously referred to has been moved or
deleted. The path can be manually fixed by editing the &#39;.ki/config&#39; file.
&#34;&#34;&#34;


# MAYBES


@monadic
@beartype
def nopath(path: Path) -&gt; Result[NoPath, Exception]:
    &#34;&#34;&#34;
    Maybe convert a path to a NoPath, i.e. a path that did not exist at
    resolve-time, which is when this function was called.
    &#34;&#34;&#34;
    path = path.resolve()
    if path.exists():
        return Err(FileExistsError(str(path)))
    return Ok(NoPath(path))


@monadic
@beartype
def xfile(path: Path, info: str = &#34;&#34;) -&gt; Result[ExtantFile, Exception]:
    &#34;&#34;&#34;
    Attempt to instantiate an ExtantFile.
    &#34;&#34;&#34;
    # Resolve path.
    path = path.resolve()

    # Check that path exists and is a file.
    if not path.exists():
        return Err(MissingFileError(path, info))
    if path.is_dir():
        return Err(ExpectedFileButGotDirectoryError(path, info))
    if not path.is_file():
        return Err(StrangeExtantPathError(path, info))

    # Must be an extant file.
    return Ok(ExtantFile(path))


@monadic
@beartype
def xdir(path: Path, info: str = &#34;&#34;) -&gt; Result[ExtantDir, Exception]:
    &#34;&#34;&#34;
    Attempt to instantiate an ExtantDir.
    &#34;&#34;&#34;
    # Resolve path.
    path = path.resolve()

    # Check that path exists and is a directory.
    if not path.exists():
        return Err(MissingDirectoryError(path, info))
    if path.is_dir():
        return Ok(ExtantDir(path))
    if path.is_file():
        return Err(ExpectedDirectoryButGotFileError(path, info))
    return Err(StrangeExtantPathError(path, info))


@monadic
@beartype
def emptydir(path: Path) -&gt; Result[ExtantDir, Exception]:
    &#34;&#34;&#34;
    Attempt to instantiate an ExtantDir.
    &#34;&#34;&#34;
    # Check if it&#39;s an extant directory.
    res: OkErr = M.xdir(path)

    # Return the Err if not.
    if res.is_err():
        return res

    # Unwrap the value otherwise.
    directory: ExtantDir = res.unwrap()
    if F.is_empty(directory):
        return Ok(EmptyDir(Path(directory).resolve()))
    return ExpectedEmptyDirectoryButGotNonEmptyDirectoryError(str(directory))


@monadic
@beartype
def repo(root: ExtantDir) -&gt; Result[git.Repo, Exception]:
    &#34;&#34;&#34;Read a git repo safely.&#34;&#34;&#34;
    try:
        repo = git.Repo(root)
    except git.InvalidGitRepositoryError as err:
        return Err(err)
    return Ok(repo)


@monadic
@beartype
def kirepo(cwd: ExtantDir) -&gt; Result[KiRepo, Exception]:
    &#34;&#34;&#34;Get the containing ki repository of `path`.&#34;&#34;&#34;
    current = cwd

    # Note that `current` is an `ExtantDir` but `FS_ROOT` is a `Path`.
    # We can make this comparison because both are instances of `Path` and
    # `Path` implements the `==` operator nicely.
    while current != FS_ROOT:
        ki_dir = F.test(current / KI)
        if isinstance(ki_dir, ExtantDir):
            break
        current = F.parent(current)

    if current == FS_ROOT:
        return Err(NotKiRepoError())

    # Root directory and ki directory of repo now guaranteed to exist.
    root = current
    repo: OkErr = M.repo(root)

    # Check that relevant files in .ki/ subdirectory exist.
    backups_dir = M.xdir(ki_dir / BACKUPS_DIR, info=BACKUPS_DIR_INFO)
    config_file = M.xfile(ki_dir / CONFIG_FILE, info=CONFIG_FILE_INFO)
    hashes_file = M.xfile(ki_dir / HASHES_FILE, info=HASHES_FILE_INFO)
    models_file = M.xfile(root / MODELS_FILE, info=MODELS_FILE_INFO)
    last_push_file = M.xfile(ki_dir / LAST_PUSH_FILE, info=LAST_PUSH_FILE_INFO)

    # Load the no_submodules_tree.
    no_modules_dir = M.xdir(ki_dir / NO_SM_DIR, info=NO_MODULES_DIR_INFO)
    no_modules_repo = M.repo(no_modules_dir)

    # Check that collection file exists.
    if config_file.is_err():
        return config_file
    config_file: ExtantFile = config_file.unwrap()
    config = configparser.ConfigParser()
    config.read(config_file)
    col_file = Path(config[REMOTE_CONFIG_SECTION][COLLECTION_FILE_PATH_CONFIG_FIELD])
    col_file = M.xfile(col_file, info=COL_FILE_INFO)

    @monadic
    @beartype
    def constructor(
        repo: git.Repo,
        root: ExtantDir,
        ki_dir: ExtantDir,
        col_file: ExtantFile,
        backups_dir: ExtantDir,
        config_file: ExtantFile,
        hashes_file: ExtantFile,
        models_file: ExtantFile,
        last_push_file: ExtantFile,
        no_modules_repo: git.Repo,
    ) -&gt; Result[KiRepo, Exception]:
        return Ok(
            KiRepo(
                repo,
                root,
                ki_dir,
                col_file,
                backups_dir,
                config_file,
                hashes_file,
                models_file,
                last_push_file,
                no_modules_repo,
            )
        )

    return constructor(
        repo,
        root,
        ki_dir,
        col_file,
        backups_dir,
        config_file,
        hashes_file,
        models_file,
        last_push_file,
        no_modules_repo,
    )


@monadic
@beartype
def kirepo_ref(kirepo: KiRepo, sha: str) -&gt; Result[KiRepoRef, Exception]:
    if not F.ref_exists(kirepo.repo, sha):
        return Err(GitRefNotFoundError(kirepo.repo, sha))
    return Ok(KiRepoRef(kirepo, sha))


@monadic
@beartype
def repo_ref(repo: git.Repo, sha: str) -&gt; Result[RepoRef, Exception]:
    if not F.ref_exists(repo, sha):
        return Err(GitRefNotFoundError(repo, sha))
    return Ok(RepoRef(repo, sha))


@monadic
@beartype
def head_repo_ref(repo: git.Repo) -&gt; Result[RepoRef, Exception]:
    # GitPython raises a ValueError when references don&#39;t exist.
    try:
        ref = RepoRef(repo, repo.head.commit.hexsha)
    except ValueError as err:
        return Err(err)
    return Ok(ref)


@monadic
@beartype
def head_kirepo_ref(kirepo: KiRepo) -&gt; Result[KiRepoRef, Exception]:
    # GitPython raises a ValueError when references don&#39;t exist.
    try:
        ref = KiRepoRef(kirepo, kirepo.repo.head.commit.hexsha)
    except ValueError as err:
        return Err(err)
    return Ok(ref)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="ki.maybes.emptydir"><code class="name flex">
<span>def <span class="ident">emptydir</span></span>(<span>path: pathlib.Path) ‑> Union[result.result.Ok[<a title="ki.types.ExtantDir" href="types.html#ki.types.ExtantDir">ExtantDir</a>], result.result.Err[Exception]]</span>
</code></dt>
<dd>
<div class="desc"><p>Attempt to instantiate an ExtantDir.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@monadic
@beartype
def emptydir(path: Path) -&gt; Result[ExtantDir, Exception]:
    &#34;&#34;&#34;
    Attempt to instantiate an ExtantDir.
    &#34;&#34;&#34;
    # Check if it&#39;s an extant directory.
    res: OkErr = M.xdir(path)

    # Return the Err if not.
    if res.is_err():
        return res

    # Unwrap the value otherwise.
    directory: ExtantDir = res.unwrap()
    if F.is_empty(directory):
        return Ok(EmptyDir(Path(directory).resolve()))
    return ExpectedEmptyDirectoryButGotNonEmptyDirectoryError(str(directory))</code></pre>
</details>
</dd>
<dt id="ki.maybes.head_kirepo_ref"><code class="name flex">
<span>def <span class="ident">head_kirepo_ref</span></span>(<span>kirepo: <a title="ki.types.KiRepo" href="types.html#ki.types.KiRepo">KiRepo</a>) ‑> Union[result.result.Ok[<a title="ki.types.KiRepoRef" href="types.html#ki.types.KiRepoRef">KiRepoRef</a>], result.result.Err[Exception]]</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@monadic
@beartype
def head_kirepo_ref(kirepo: KiRepo) -&gt; Result[KiRepoRef, Exception]:
    # GitPython raises a ValueError when references don&#39;t exist.
    try:
        ref = KiRepoRef(kirepo, kirepo.repo.head.commit.hexsha)
    except ValueError as err:
        return Err(err)
    return Ok(ref)</code></pre>
</details>
</dd>
<dt id="ki.maybes.head_repo_ref"><code class="name flex">
<span>def <span class="ident">head_repo_ref</span></span>(<span>repo: git.repo.base.Repo) ‑> Union[result.result.Ok[<a title="ki.types.RepoRef" href="types.html#ki.types.RepoRef">RepoRef</a>], result.result.Err[Exception]]</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@monadic
@beartype
def head_repo_ref(repo: git.Repo) -&gt; Result[RepoRef, Exception]:
    # GitPython raises a ValueError when references don&#39;t exist.
    try:
        ref = RepoRef(repo, repo.head.commit.hexsha)
    except ValueError as err:
        return Err(err)
    return Ok(ref)</code></pre>
</details>
</dd>
<dt id="ki.maybes.kirepo"><code class="name flex">
<span>def <span class="ident">kirepo</span></span>(<span>cwd: <a title="ki.types.ExtantDir" href="types.html#ki.types.ExtantDir">ExtantDir</a>) ‑> Union[result.result.Ok[<a title="ki.types.KiRepo" href="types.html#ki.types.KiRepo">KiRepo</a>], result.result.Err[Exception]]</span>
</code></dt>
<dd>
<div class="desc"><p>Get the containing ki repository of <code>path</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@monadic
@beartype
def kirepo(cwd: ExtantDir) -&gt; Result[KiRepo, Exception]:
    &#34;&#34;&#34;Get the containing ki repository of `path`.&#34;&#34;&#34;
    current = cwd

    # Note that `current` is an `ExtantDir` but `FS_ROOT` is a `Path`.
    # We can make this comparison because both are instances of `Path` and
    # `Path` implements the `==` operator nicely.
    while current != FS_ROOT:
        ki_dir = F.test(current / KI)
        if isinstance(ki_dir, ExtantDir):
            break
        current = F.parent(current)

    if current == FS_ROOT:
        return Err(NotKiRepoError())

    # Root directory and ki directory of repo now guaranteed to exist.
    root = current
    repo: OkErr = M.repo(root)

    # Check that relevant files in .ki/ subdirectory exist.
    backups_dir = M.xdir(ki_dir / BACKUPS_DIR, info=BACKUPS_DIR_INFO)
    config_file = M.xfile(ki_dir / CONFIG_FILE, info=CONFIG_FILE_INFO)
    hashes_file = M.xfile(ki_dir / HASHES_FILE, info=HASHES_FILE_INFO)
    models_file = M.xfile(root / MODELS_FILE, info=MODELS_FILE_INFO)
    last_push_file = M.xfile(ki_dir / LAST_PUSH_FILE, info=LAST_PUSH_FILE_INFO)

    # Load the no_submodules_tree.
    no_modules_dir = M.xdir(ki_dir / NO_SM_DIR, info=NO_MODULES_DIR_INFO)
    no_modules_repo = M.repo(no_modules_dir)

    # Check that collection file exists.
    if config_file.is_err():
        return config_file
    config_file: ExtantFile = config_file.unwrap()
    config = configparser.ConfigParser()
    config.read(config_file)
    col_file = Path(config[REMOTE_CONFIG_SECTION][COLLECTION_FILE_PATH_CONFIG_FIELD])
    col_file = M.xfile(col_file, info=COL_FILE_INFO)

    @monadic
    @beartype
    def constructor(
        repo: git.Repo,
        root: ExtantDir,
        ki_dir: ExtantDir,
        col_file: ExtantFile,
        backups_dir: ExtantDir,
        config_file: ExtantFile,
        hashes_file: ExtantFile,
        models_file: ExtantFile,
        last_push_file: ExtantFile,
        no_modules_repo: git.Repo,
    ) -&gt; Result[KiRepo, Exception]:
        return Ok(
            KiRepo(
                repo,
                root,
                ki_dir,
                col_file,
                backups_dir,
                config_file,
                hashes_file,
                models_file,
                last_push_file,
                no_modules_repo,
            )
        )

    return constructor(
        repo,
        root,
        ki_dir,
        col_file,
        backups_dir,
        config_file,
        hashes_file,
        models_file,
        last_push_file,
        no_modules_repo,
    )</code></pre>
</details>
</dd>
<dt id="ki.maybes.kirepo_ref"><code class="name flex">
<span>def <span class="ident">kirepo_ref</span></span>(<span>kirepo: <a title="ki.types.KiRepo" href="types.html#ki.types.KiRepo">KiRepo</a>, sha: str) ‑> Union[result.result.Ok[<a title="ki.types.KiRepoRef" href="types.html#ki.types.KiRepoRef">KiRepoRef</a>], result.result.Err[Exception]]</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@monadic
@beartype
def kirepo_ref(kirepo: KiRepo, sha: str) -&gt; Result[KiRepoRef, Exception]:
    if not F.ref_exists(kirepo.repo, sha):
        return Err(GitRefNotFoundError(kirepo.repo, sha))
    return Ok(KiRepoRef(kirepo, sha))</code></pre>
</details>
</dd>
<dt id="ki.maybes.nopath"><code class="name flex">
<span>def <span class="ident">nopath</span></span>(<span>path: pathlib.Path) ‑> Union[result.result.Ok[<a title="ki.types.NoPath" href="types.html#ki.types.NoPath">NoPath</a>], result.result.Err[Exception]]</span>
</code></dt>
<dd>
<div class="desc"><p>Maybe convert a path to a NoPath, i.e. a path that did not exist at
resolve-time, which is when this function was called.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@monadic
@beartype
def nopath(path: Path) -&gt; Result[NoPath, Exception]:
    &#34;&#34;&#34;
    Maybe convert a path to a NoPath, i.e. a path that did not exist at
    resolve-time, which is when this function was called.
    &#34;&#34;&#34;
    path = path.resolve()
    if path.exists():
        return Err(FileExistsError(str(path)))
    return Ok(NoPath(path))</code></pre>
</details>
</dd>
<dt id="ki.maybes.repo"><code class="name flex">
<span>def <span class="ident">repo</span></span>(<span>root: <a title="ki.types.ExtantDir" href="types.html#ki.types.ExtantDir">ExtantDir</a>) ‑> Union[result.result.Ok[git.repo.base.Repo], result.result.Err[Exception]]</span>
</code></dt>
<dd>
<div class="desc"><p>Read a git repo safely.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@monadic
@beartype
def repo(root: ExtantDir) -&gt; Result[git.Repo, Exception]:
    &#34;&#34;&#34;Read a git repo safely.&#34;&#34;&#34;
    try:
        repo = git.Repo(root)
    except git.InvalidGitRepositoryError as err:
        return Err(err)
    return Ok(repo)</code></pre>
</details>
</dd>
<dt id="ki.maybes.repo_ref"><code class="name flex">
<span>def <span class="ident">repo_ref</span></span>(<span>repo: git.repo.base.Repo, sha: str) ‑> Union[result.result.Ok[<a title="ki.types.RepoRef" href="types.html#ki.types.RepoRef">RepoRef</a>], result.result.Err[Exception]]</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@monadic
@beartype
def repo_ref(repo: git.Repo, sha: str) -&gt; Result[RepoRef, Exception]:
    if not F.ref_exists(repo, sha):
        return Err(GitRefNotFoundError(repo, sha))
    return Ok(RepoRef(repo, sha))</code></pre>
</details>
</dd>
<dt id="ki.maybes.xdir"><code class="name flex">
<span>def <span class="ident">xdir</span></span>(<span>path: pathlib.Path, info: str = '') ‑> Union[result.result.Ok[<a title="ki.types.ExtantDir" href="types.html#ki.types.ExtantDir">ExtantDir</a>], result.result.Err[Exception]]</span>
</code></dt>
<dd>
<div class="desc"><p>Attempt to instantiate an ExtantDir.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@monadic
@beartype
def xdir(path: Path, info: str = &#34;&#34;) -&gt; Result[ExtantDir, Exception]:
    &#34;&#34;&#34;
    Attempt to instantiate an ExtantDir.
    &#34;&#34;&#34;
    # Resolve path.
    path = path.resolve()

    # Check that path exists and is a directory.
    if not path.exists():
        return Err(MissingDirectoryError(path, info))
    if path.is_dir():
        return Ok(ExtantDir(path))
    if path.is_file():
        return Err(ExpectedDirectoryButGotFileError(path, info))
    return Err(StrangeExtantPathError(path, info))</code></pre>
</details>
</dd>
<dt id="ki.maybes.xfile"><code class="name flex">
<span>def <span class="ident">xfile</span></span>(<span>path: pathlib.Path, info: str = '') ‑> Union[result.result.Ok[<a title="ki.types.ExtantFile" href="types.html#ki.types.ExtantFile">ExtantFile</a>], result.result.Err[Exception]]</span>
</code></dt>
<dd>
<div class="desc"><p>Attempt to instantiate an ExtantFile.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@monadic
@beartype
def xfile(path: Path, info: str = &#34;&#34;) -&gt; Result[ExtantFile, Exception]:
    &#34;&#34;&#34;
    Attempt to instantiate an ExtantFile.
    &#34;&#34;&#34;
    # Resolve path.
    path = path.resolve()

    # Check that path exists and is a file.
    if not path.exists():
        return Err(MissingFileError(path, info))
    if path.is_dir():
        return Err(ExpectedFileButGotDirectoryError(path, info))
    if not path.is_file():
        return Err(StrangeExtantPathError(path, info))

    # Must be an extant file.
    return Ok(ExtantFile(path))</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="ki Home" href="index.html">
<img src="u1F367-shavedice.svg" alt=""> ki
</a>
</header>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="ki" href="index.html">ki</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="ki.maybes.emptydir" href="#ki.maybes.emptydir">emptydir</a></code></li>
<li><code><a title="ki.maybes.head_kirepo_ref" href="#ki.maybes.head_kirepo_ref">head_kirepo_ref</a></code></li>
<li><code><a title="ki.maybes.head_repo_ref" href="#ki.maybes.head_repo_ref">head_repo_ref</a></code></li>
<li><code><a title="ki.maybes.kirepo" href="#ki.maybes.kirepo">kirepo</a></code></li>
<li><code><a title="ki.maybes.kirepo_ref" href="#ki.maybes.kirepo_ref">kirepo_ref</a></code></li>
<li><code><a title="ki.maybes.nopath" href="#ki.maybes.nopath">nopath</a></code></li>
<li><code><a title="ki.maybes.repo" href="#ki.maybes.repo">repo</a></code></li>
<li><code><a title="ki.maybes.repo_ref" href="#ki.maybes.repo_ref">repo_ref</a></code></li>
<li><code><a title="ki.maybes.xdir" href="#ki.maybes.xdir">xdir</a></code></li>
<li><code><a title="ki.maybes.xfile" href="#ki.maybes.xfile">xfile</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>